import{q as P,H as B,O as Z,ah as q,w as J,r as c,c as Q,e as N,o as W,D as $,p as O,aM as _,al as ee,W as te,ar as ne,R as Ae,F,T as o,I as p,S as v,Q as K,aN as ae,E as j,G as V,_ as le}from"./index-2vi5jfnI.js";var H=J({name:"vue3-danmaku",components:{},props:{danmus:{type:Array,required:!0,default:()=>[]},channels:{type:Number,default:0},autoplay:{type:Boolean,default:!0},loop:{type:Boolean,default:!1},useSlot:{type:Boolean,default:!1},debounce:{type:Number,default:100},speeds:{type:Number,default:200},randomChannel:{type:Boolean,default:!1},fontSize:{type:Number,default:18},top:{type:Number,default:4},right:{type:Number,default:0},isSuspend:{type:Boolean,default:!1},extraStyle:{type:String,default:""}},emits:["list-end","play-end","dm-over","dm-out","update:danmus"],setup(s,{emit:g,slots:i}){let y=c(document.createElement("div")),A=c(document.createElement("div"));const h=c(0),r=c(0);let k=0;const T=c(0),D=c(0),E=c(0),x=c(!1),I=c(!1),M=c({}),m=function(l,d,t="modelValue",n){return Q({get:()=>l[t],set:S=>{d(`update:${t}`,S)}})}(s,g,"danmus"),C=N({channels:Q(()=>s.channels||T.value),autoplay:Q(()=>s.autoplay),loop:Q(()=>s.loop),useSlot:Q(()=>s.useSlot),debounce:Q(()=>s.debounce),randomChannel:Q(()=>s.randomChannel)}),a=N({height:Q(()=>D.value),fontSize:Q(()=>s.fontSize),speeds:Q(()=>s.speeds),top:Q(()=>s.top),right:Q(()=>s.right)});function e(){f(),s.isSuspend&&function(){let l=[];A.value.addEventListener("mouseover",d=>{let t=d.target;t.className.includes("dm")||(t=t.closest(".dm")||t),t.className.includes("dm")&&(l.includes(t)||(g("dm-over",{el:t}),t.classList.add("pause"),l.push(t)))}),A.value.addEventListener("mouseout",d=>{let t=d.target;t.className.includes("dm")||(t=t.closest(".dm")||t),t.className.includes("dm")&&(g("dm-out",{el:t}),t.classList.remove("pause"),l.forEach(n=>{n.classList.remove("pause")}),l=[])})}(),C.autoplay&&G()}function f(){if(h.value=y.value.offsetWidth,r.value=y.value.offsetHeight,h.value===0||r.value===0)throw new Error("获取不到容器宽高")}function G(){I.value=!1,k||(k=window.setInterval(()=>function(){if(!I.value&&m.value.length)if(E.value>m.value.length-1){const l=A.value.children.length;C.loop&&(l<E.value&&(g("list-end"),E.value=0),u())}else u()}(),C.debounce))}function u(l){const d=C.loop?E.value%m.value.length:E.value,t=l||m.value[d];let n=document.createElement("div");C.useSlot?n=function(S,w){return _({render:()=>ee("div",{},[i.dm&&i.dm({danmu:S,index:w})])}).mount(document.createElement("div"))}(t,d).$el:(n.innerHTML=t,n.setAttribute("style",s.extraStyle),n.style.fontSize=`${a.fontSize}px`,n.style.lineHeight=`${a.fontSize}px`),n.classList.add("dm"),A.value.appendChild(n),n.style.opacity="0",te(()=>{a.height||(D.value=n.offsetHeight),C.channels||(T.value=Math.floor(r.value/(a.height+a.top)));let S=function(w){let R=[...Array(C.channels).keys()];C.randomChannel&&(R=R.sort(()=>.5-Math.random()));for(let b of R){const U=M.value[b];if(!U||!U.length)return M.value[b]=[w],w.addEventListener("animationend",()=>M.value[b].splice(0,1)),b%C.channels;for(let Y=0;Y<U.length;Y++){const L=X(U[Y])-10;if(L<=.88*(w.offsetWidth-U[Y].offsetWidth)||L<=0)break;if(Y===U.length-1)return M.value[b].push(w),w.addEventListener("animationend",()=>M.value[b].splice(0,1)),b%C.channels}}return-1}(n);if(S>=0){const w=n.offsetWidth,R=a.height;n.classList.add("move"),n.dataset.index=`${d}`,n.dataset.channel=S.toString(),n.style.opacity="1",n.style.top=S*(R+a.top)+"px",n.style.width=w+a.right+"px",n.style.setProperty("--dm-scroll-width",`-${h.value+w}px`),n.style.left=`${h.value}px`,n.style.animationDuration=h.value/a.speeds+"s",n.addEventListener("animationend",()=>{Number(n.dataset.index)!==m.value.length-1||C.loop||g("play-end",n.dataset.index),A.value&&A.value.removeChild(n)}),E.value++}else A.value.removeChild(n)})}function X(l){const d=l.offsetWidth||parseInt(l.style.width),t=l.getBoundingClientRect().right||A.value.getBoundingClientRect().right+d;return A.value.getBoundingClientRect().right-t}function z(){clearInterval(k),k=0,E.value=0}return W(()=>{e()}),$(()=>{z()}),{container:y,dmContainer:A,hidden:x,paused:I,danmuList:m,getPlayState:function(){return!I.value},resize:function(){f();const l=A.value.getElementsByClassName("dm");for(let d=0;d<l.length;d++){const t=l[d];t.style.setProperty("--dm-scroll-width",`-${h.value+t.offsetWidth}px`),t.style.left=`${h.value}px`,t.style.animationDuration=h.value/a.speeds+"s"}},play:G,pause:function(){I.value=!0},stop:function(){M.value={},A.value.innerHTML="",I.value=!0,x.value=!1,z()},show:function(){x.value=!1},hide:function(){x.value=!0},reset:function(){D.value=0,e()},add:function(l){if(E.value===m.value.length)return m.value.push(l),m.value.length-1;{const d=E.value%m.value.length;return m.value.splice(d,0,l),d+1}},push:function(l){return m.value.push(l),m.value.length-1},insert:u}}});const se={ref:"container",class:"vue-danmaku"};(function(s,g){g===void 0&&(g={});var i=g.insertAt;if(typeof document!="undefined"){var y=document.head||document.getElementsByTagName("head")[0],A=document.createElement("style");A.type="text/css",i==="top"&&y.firstChild?y.insertBefore(A,y.firstChild):y.appendChild(A),A.styleSheet?A.styleSheet.cssText=s:A.appendChild(document.createTextNode(s))}})(`.vue-danmaku {
  position: relative;
  overflow: hidden;
}
.vue-danmaku .danmus {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  -webkit-transition: all 0.3s;
  transition: all 0.3s;
}
.vue-danmaku .danmus.show {
  opacity: 1;
}
.vue-danmaku .danmus.paused .dm.move {
  animation-play-state: paused;
}
.vue-danmaku .danmus .dm {
  position: absolute;
  font-size: 20px;
  color: #ddd;
  white-space: pre;
  transform: translateX(0);
  transform-style: preserve-3d;
}
.vue-danmaku .danmus .dm.move {
  will-change: transform;
  animation-name: moveLeft;
  animation-timing-function: linear;
  animation-play-state: running;
}
.vue-danmaku .danmus .dm.pause {
  animation-play-state: paused;
  z-index: 100;
}
@keyframes moveLeft {
  from {
    transform: translateX(0);
  }
  to {
    transform: translateX(var(--dm-scroll-width));
  }
}
@-webkit-keyframes moveLeft {
  from {
    -webkit-transform: translateX(0);
  }
  to {
    -webkit-transform: translateX(var(--dm-scroll-width));
  }
}`),H.render=function(s,g,i,y,A,h){return O(),P("div",se,[B("div",{ref:"dmContainer",class:Z(["danmus",{show:!s.hidden},{paused:s.paused}])},null,2),q(s.$slots,"default")],512)},H.__file="src/lib/Danmaku.vue";const oe={class:"gap-5 welcome flex flex-col"},ue={class:"main"},ie={class:"ml-5"},de={class:"ml-5"},re={class:"ml-5"},fe={class:"flex"},me=J({name:"Danmaku",__name:"index",setup(s){const g=[{avatar:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/sBCgoKCgoKCwwMCw8QDhAPFhQTExQWIhgaGBoYIjMgJSAgJSAzLTcsKSw3LVFAODhAUV5PSk9ecWVlcY+Ij7u7+//CABEIADIAMgMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAFBAYBAgMAB//aAAgBAQAAAAD7HU4ObhMC3AnlYvY8ISwA+6WDOd4/RA96FVeF66BOVWB3TsAOgZC27wv/xAAYAQEBAQEBAAAAAAAAAAAAAAACAwQAAf/aAAgBAhAAAAC3sw8uyRDQPV//xAAYAQADAQEAAAAAAAAAAAAAAAAAAgMBBP/aAAgBAxAAAACQ7LfmoUTNvFf/xAA0EAACAQMBBAcHAwUAAAAAAAABAgMABBESBRMxQRAhIjJRYbEUIzRCUnOBM3KSU2KRoeH/2gAIAQEAAT8AmmSCJpHOAoq6vZp8lmITkgonSQCMZxikkdGDxsVbxFbK2l7TGUkwHQfy6Ln4if7jetbcdglvH9TFv40hD71CGzlQpAyACRkt4VcxojxOdIj06GzwA5VKkilGUdjUcNxD9XlwI5g1Bfm0u4nC5UHDeYNWu0LS4B3D6mHHIwaufiJ/uN61tm6Et6GPCIbv8mtqi4gtrFkzjeuxIGRq+TP4orI1jpK+8MHAfVprYcM8kVysmoIGiwG8UfVgVcwh1ecDGiYcvlNWk7W9zDKucqwyPEVOczzfvb1q/wBkXWqR4Sja8nDHGCajAEagHIAx/jourmK0haaV9KrWyrFZLRZJ07MqNhc8Q3M/irfZFlaOGQF2HzOc1cACeYD+o3r0XptYEJKAyMx06TgsxOaupr+MhkIQk6TlfPlkVNCIxBc3A9onLjRG/WtWV1BPFlRp09TpzBHLoufiJ/uN69G05JLxt8C2ksQpTiAMHIq0mQz6HnMnZwurBwBRhKTLLK5Y6Oz/AGf9qwla3u4TykBRh/sdFx8RN9xvWpri43Unv5O6fmNSSSCHGtsb0DGfKrFm3zdZ7o9RUskhMnbbu+NLJJrh7bfqJz869onxjfSY/callk3knvG7x51//8QAIxEAAgEEAQMFAAAAAAAAAAAAAQIRAAMSMRAEIXETMjNBUf/aAAgBAgEBPwBMUTNv3tSdQrgZDYpwMmx0N8PdFv0iBMAyKS4QroF99JcxDhhMntwxgUCoJIER90jZCeG2PBpvjNWtHzx//8QAIBEAAgICAgIDAAAAAAAAAAAAAQIAERASAyEyM0GBkf/aAAgBAwEBPwBtmbURuErdRb1W/nCIW3vqMgJVr8YyWVIyvYG/5CKwJze36jY//9k=",name:"美绪",text:"马什么梅？"},{avatar:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/sBCgoKCgoKCwwMCw8QDhAPFhQTExQWIhgaGBoYIjMgJSAgJSAzLTcsKSw3LVFAODhAUV5PSk9ecWVlcY+Ij7u7+//CABEIADIAMgMBIgACEQEDEQH/xAAbAAACAwEBAQAAAAAAAAAAAAAABQIDBAEGB//aAAgBAQAAAAD65hzG3WLcATfCbHYQ9IY0uiEfRkU1IOr+RoUG1ornWj7Y6//EABgBAQADAQAAAAAAAAAAAAAAAAQAAgUD/9oACAECEAAAACEf3IJba51tGDNq/wD/xAAYAQEAAwEAAAAAAAAAAAAAAAAEAQMFAv/aAAgBAxAAAABSg0MWQdj+c6VozP/EAC0QAAIBAwMBBgUFAAAAAAAAAAECEQADBBASMUEiUVJhcZEFExQhgSAyQoKx/9oACAEBAAE/AKu5oEi2A3meKOXf8cfgV9Xe2kEgyOeCKsZSXAqs0XP91z7+wC3MSCzeg/RbuG06uO8T6a5kNkOOu0CpUXWQMdo4kQRPQihPd9tH+4jXIw0yDukq0RNHFu2/iOVku0pfx7foHt91MttbMyN7njqQDo3BPkdWEqRJEjkV8QOV2LVq2xBBlkoq+y181CrgHn1nXHffZQ+UH8aEwCaEoJP9qzbe+ySOUO7XCuxca2f5CR6jS477H7bftPWt7+NvekdzbWXYyo60rvtXtHgda3v4j71Yd/qLPaPJ6+Vb38be9f/EACYRAAECBAQHAQAAAAAAAAAAAAECAwAEEBIREzFSITNBQlFhgXL/2gAIAQIBAT8AffKDYjXqYznd5hhwuI46ijjOOaSfaYUm232Ik9F/KKQFRMN2LHgiJVdrmG6s32fYa5iP0Kf/xAAmEQABAgQFBAMAAAAAAAAAAAABAgMAEBESBBNCUoEhMTNhUXFy/9oACAEDAQE/AGGAoXK4EZLWwQ+2G19Oxk28RlhI9GEqur9xi9HMm3C2qtAfRhhy9J+axiUXIrtnhdfEOeNf5Mv/2Q==",name:"博士",text:"马东什么？"},{avatar:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/sBCgoKCgoKCwwMCw8QDhAPFhQTExQWIhgaGBoYIjMgJSAgJSAzLTcsKSw3LVFAODhAUV5PSk9ecWVlcY+Ij7u7+//CABEIADIAMgMBIgACEQEDEQH/xAAxAAACAgMBAAAAAAAAAAAAAAAABgQFAQIHAwEBAAMBAAAAAAAAAAAAAAAAAwABAgT/2gAMAwEAAhADEAAAAI7CsPnN1VeZ0okpTbSWASKzwmMPRy3PuuWhpv4KvQ7pcJYTUb+hdLQYWJoaVU+RU3jcXiaoegAhWOAPeeaBd1wGtf/EAC4QAAIBAwIEBAUFAQAAAAAAAAECAwAEEQUhBhASMRMiQWEUI3KBoSAzQlFSkv/aAAgBAQABPwDTxidHHbdTyZGjdkcYYelBGKM4HlUgH7/osXInRfQsK0q18abxGHkj/JrV0KXrEfzUGtLiE0F1G48r4GfcVJDJFI0TbMp52W91D9VXt42mWQCu0QUqHZQC7SyDIRA22QO5NXkFyLeFpnWRggYsMZw/+ioAPsRVlOtrpsshx+6d2OFGw3J/oVK897YR6nbfORCTkp0OVQ7lRk5Aq5gMZSVR8qVepfbPpy0jDSRyEZxIg/6JrjKJytlEEJ63uJD7ttXB6Tn41bhW8Mwxxjqzt3OBWrx+Bw9fQsRvIgBzjYutcP3F8upWVmZZltvjFPQW22BqeAJpHh+kWyeyhsL+KXS9RcB1WLpYZGSc4NcKwxTrcRy+qrj2IJIqe3S5AEsSOAcgMobB+9Lb9KhVAAHYCntRIjI6hkYYZWGQRUGm2ltMssVsiSKCAVGMZqWFZ4fDY4XYn7ULaEgF182N/Me9cIuI3kY9gFodLAEHINFgKDKdqwK1LVotOMSsnWz5JAPYUeJZyTiKMVwv2n+la08npcZOBjke3LVWZtRuizE4kI5f/8QAIBEBAAIBAgcAAAAAAAAAAAAAAQARAwIQEiAhMTJBcf/aAAgBAgEBPwDL5HzkadfX0RDjmTSUJtks1MqWpVypk7uxt//EACARAQABAwMFAAAAAAAAAAAAAAEAAhEhAxATEiIxYXH/2gAIAQMBAT8A0m1L9l+2++Sg9sF45p1N7M6iUJYwM5GYW4ZmZT4Njb//2Q==",name:"柚子",text:"什么冬梅？"}],i=c(),y=c(g),A=c("");let h=0;const r=N({channels:3,useSlot:!0,loop:!0,speeds:80,fontSize:16,top:10,right:0,debounce:100,randomChannel:!0});W(()=>{window.onresize=()=>I()}),ne(()=>{window.onresize=null});function k(a){switch(a){case"play":i.value.play();break;case"pause":i.value.pause();break;case"stop":i.value.stop();break;case"show":i.value.show();break;case"hide":i.value.hide();break;case"reset":i.value.reset();break}}function T(a){r.useSlot=a,y.value=g.map(e=>a?e:e.text),setTimeout(()=>{i.value.stop(),i.value.play()})}function D(a){r.speeds<=10&&a===-10||(r.speeds+=a,i.value.reset())}function E(a){r.fontSize+=a,i.value.reset()}function x(a){!r.channels&&a===-1||(r.channels+=a)}function I(){h&&clearTimeout(h),h=window.setTimeout(()=>{i.value.resize()},500)}function M(){if(!A.value)return;const a=r.useSlot?{avatar:"https://i.loli.net/2021/01/17/xpwbm3jKytfaNOD.jpg",name:"你",text:A.value}:A.value;i.value.add(a),A.value=""}const m=c(null),C=()=>{const e=document.getElementById("testMark").getContext("2d");e.lineWidth=1,e.strokeStyle="blue",e.beginPath(),e.moveTo(10,10),e.lineTo(150,50),e.lineTo(200,100),e.lineTo(10,10),e.closePath(),e.stroke()};return W(()=>{C()}),(a,e)=>{const f=j("el-button"),G=j("el-input");return O(),P("div",oe,[B("canvas",{ref_key:"marksCanvasRef",ref:m,id:"testMark",style:{width:"200px",height:"400px",border:"1px solid"}},null,512),Ae("",!0),B("div",ue,[F(B("p",null,[o(" 播放： "),p(f,{onClick:e[1]||(e[1]=u=>k("play"))},{default:v(()=>[o("播放")]),_:1}),p(f,{onClick:e[2]||(e[2]=u=>k("pause"))},{default:v(()=>[o("暂停")]),_:1}),p(f,{onClick:e[3]||(e[3]=u=>k("stop"))},{default:v(()=>[o("停止")]),_:1})],512),[[V,!1]]),F(B("p",null,[o(" 模式： "),p(f,{onClick:e[4]||(e[4]=u=>T(!0))},{default:v(()=>[o("弹幕 slot")]),_:1}),p(f,{onClick:e[5]||(e[5]=u=>T(!1))},{default:v(()=>[o("普通文本")]),_:1})],512),[[V,!1]]),F(B("p",null,[o(" 显示： "),p(f,{onClick:e[6]||(e[6]=u=>k("show"))},{default:v(()=>[o("显示")]),_:1}),p(f,{onClick:e[7]||(e[7]=u=>k("hide"))},{default:v(()=>[o("隐藏")]),_:1})],512),[[V,!1]]),F(B("p",null,[o(" 速度： "),p(f,{onClick:e[8]||(e[8]=u=>D(-10))},{default:v(()=>[o("减速")]),_:1}),p(f,{onClick:e[9]||(e[9]=u=>D(10))},{default:v(()=>[o("增速")]),_:1}),B("span",ie,"当前速度："+K(r.speeds)+"像素/s",1)],512),[[V,!1]]),F(B("p",null,[o(" 字号： "),p(f,{disabled:r.useSlot,onClick:e[10]||(e[10]=u=>E(-1))},{default:v(()=>[o(" 缩小 ")]),_:1},8,["disabled"]),p(f,{disabled:r.useSlot,onClick:e[11]||(e[11]=u=>E(1))},{default:v(()=>[o(" 放大 ")]),_:1},8,["disabled"]),B("span",de,"当前字号："+K(r.fontSize)+"px",1)],512),[[V,!1]]),F(B("p",null,[o(" 轨道： "),p(f,{onClick:e[12]||(e[12]=u=>x(-1))},{default:v(()=>[o("-1")]),_:1}),p(f,{onClick:e[13]||(e[13]=u=>x(1))},{default:v(()=>[o("+1")]),_:1}),p(f,{onClick:e[14]||(e[14]=u=>x(-r.channels))},{default:v(()=>[o(" 填满 ")]),_:1}),B("span",re,"当前轨道："+K(r.channels),1)],512),[[V,!1]]),B("p",fe,[p(G,{modelValue:A.value,"onUpdate:modelValue":e[15]||(e[15]=u=>A.value=u),type:"text",placeholder:"输入评论后，回车发送弹幕",onKeyup:ae(M,["enter"])},null,8,["modelValue"])])])])}}}),ve=le(me,[["__scopeId","data-v-531b3e17"]]);export{ve as default};
